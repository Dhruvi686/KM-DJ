<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/animation.css">
  <link rel="stylesheet" href="css/header.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>

  <div class="container fade-in-slide-up">
    <h1>Login</h1>
  <form id="loginForm">
    <label>User ID:</label>
    <input type="text" name="userId" id="userIdInput" required>

    <label>Email:</label>
    <input type="Email" name="Email" required> 

    <label>Password:</label>
    <input type="password" name="password" required> 
    <button type="submit">Login</button>
  </form>
    <p><a href="#" id="forgotPasswordLink">Forgot Password?</a></p>
    <div id="forgotModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.3);z-index:1000;">
      <div style="background:#fff;padding:32px 24px 24px 24px;border-radius:16px;max-width:400px;margin:80px auto;box-shadow:0 4px 32px #bbb;position:relative;">
        <button id="closeModal" style="position:absolute;top:12px;right:12px;background:#111;color:#fff;border:none;border-radius:50%;width:32px;height:32px;font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center;line-height:0;padding:0;">&times;</button>
        <h2 style="text-align:center;margin-bottom:24px;">Set New Password</h2>
        <form id="resetForm" style="display:flex;flex-direction:column;gap:16px;">
          <div>
            <label for="resetEmail">Email:</label>
            <input type="email" name="email" id="resetEmail" required>
          </div>
          <div>
            <label for="newPassword">New Password:</label>
            <input type="password" name="newPassword" id="newPassword" required>
          </div>
          <div>
            <label for="confirmPassword">Confirm Password:</label>
            <input type="password" name="confirmPassword" id="confirmPassword" required>
          </div>
          <button type="submit" style="width:100%;padding:12px;background:#111;color:#fff;border:none;border-radius:8px;font-size:18px;cursor:pointer;">Set New Password</button>
        </form>
      </div>
    </div>
    <p>Don't have an account? <a href="signup.html">Sign up here</a></p>
    
    
    </div>
  </div>
  <div id="footer" style="background:#f3f4f6;padding:32px 0 0 0;">
    <div style="display:flex;flex-wrap:wrap;justify-content:center;gap:64px;max-width:1100px;margin:0 auto 0 auto;">
     
    </div>
    <div style="text-align:center;color:#aaa;font-size:0.95rem;margin:32px 0 0 0;">&copy; 2025 SynergySphere. All rights reserved.</div>
  </div>
  <script src="js/main.js"></script>
  <script src="js/animation.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const userId = this.userId.value;
        const password = this.password.value;
        const res = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userId, password })
        });
        const data = await res.json();
        alert(data.message);
        if (data.success) {
          // Store user info for later use
          localStorage.setItem('user', JSON.stringify({
            name: data.name,
            role: data.role,
            userId: data.userId,
            email: data.email
          }));
          // If CEO, redirect to ceo-dashboard.html, if Employee, redirect to Employee.html, if Team-Leader, redirect to Team_Leader.html, else to index.html
          if (data.role && data.role.toLowerCase() === 'ceo') {
            window.location.href = 'ceo-dashboard.html';
          } else if (data.role && data.role.toLowerCase() === 'employee') {
            window.location.href = 'Employee.html';
          } else if (data.role && (data.role.toLowerCase() === 'team-leader' || data.role.toLowerCase() === 'team leader')) {
            window.location.href = 'Team_Leader.html';
          } else {
            window.location.href = 'index.html';
          }
        }
      });
        // Forgot Password Modal
        const forgotLink = document.getElementById('forgotPasswordLink');
        const forgotModal = document.getElementById('forgotModal');
        const closeModal = document.getElementById('closeModal');
        const resetForm = document.getElementById('resetForm');
        const confirmPasswordInput = document.getElementById('confirmPassword');

        confirmPasswordInput.addEventListener('keyup', function(event) {
          if (event.key === 'Enter') {
            resetForm.dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));
          }
        });

        forgotLink.onclick = () => { forgotModal.style.display = 'block'; };
        closeModal.onclick = () => { forgotModal.style.display = 'none'; };
        resetForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          const email = document.getElementById('resetEmail').value;
          const newPassword = document.getElementById('newPassword').value;
          const confirmPassword = document.getElementById('confirmPassword').value;
          if (newPassword !== confirmPassword) {
            alert('New Password and Confirm Password do not match!');
            document.getElementById('confirmPassword').focus();
            return;
          }
          // In a real app, you'd send a reset token. For now, we send the email.
          const res = await fetch('/api/auth/reset', { // Updated endpoint
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, newPassword })
          });
          const data = await res.json();
          if (data.success) {
            alert('Password set successfully!');
            forgotModal.style.display = 'none';
            window.location.href = 'login.html';
          } else {
            alert(data.message); 
          }
        });
    });
  </script>
</body>
</html>